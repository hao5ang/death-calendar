<header>
    <title>death calendar</title>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        table,
        tr,
        td {
            border: 1px solid #D3D3D3;
            padding: 15px;
            border-collapse: collapse;
        }

        .alive-before {
            background-color: #C0C0C0;
        }

        .alive-after {
            background-color: #C0C0C0;
        }

        .alive {
            border: 2px solid #DCDCDC;
        }

        .curr-year {
            color: red;
            font-weight: bold;
        }

        .year-class {
            font-size: large;
            font-weight: bold;
        }

        .zediac-span {
            font-size: 40px;
        }

        .age-icon {
            font-size: 35px;
        }

        td.curr-year {
            border: 3px solid red;
        }

        .progress {
            font-size: small;
            font-weight: normal;
            padding-left: 10px;
        }
    </style>

    <script>
        $(document).ready(function () {

            function loadLocal() {
                var birth = localStorage.birth;
                var deathAge = localStorage.deathAge;
                var gender = localStorage.gender;
                if (birth) {
                    $("#birthInput").val(birth);
                }
                if (deathAge) {
                    $("#deathAge").val(deathAge);
                }
                if (gender) {
                    $("input[name=gender][value=" + gender + "]").attr('checked', 'checked');
                }
            }


            function refresh() {

                var birthStr = $("#birthInput").val();
                var deathAge = parseInt($("#deathAge").val());
                var gender = $('input[name="gender"]:checked').val();
                localStorage.birth = birthStr;
                localStorage.deathAge = deathAge;
                localStorage.gender = gender;

                var zodiac = ["🐒", "🐔", "🐶", "🐷", "🐭", "🐂", "🐯", "🐰", "🐲", "🐍", "🐴", "🐑"];
                var ageIconArr1 = ["🏥", "👶🏻", "👦🏻", "🧑🏻", "🧔🏻", "👨🏻‍🦳", "👴🏻"];
                var ageIconArr2 = ["🏥", "👶🏻", "👧🏻", "🧑🏻", "👩🏻", "🧓🏻", "👵🏼"];
                var ageIconArr = ageIconArr1;
                if (gender == "female") {
                    ageIconArr = ageIconArr2;
                }


                var currentDate = new Date();
                var currentYear = currentDate.getFullYear();


                if (deathAge <= 0) {
                    deathAge = 1;
                }
                var birth = new Date(birthStr);
                var birthYear = birth.getFullYear();
                var startYear = Math.floor(birthYear / 10) * 10 - 20;
                var deadYear = birthYear + deathAge;
                var endYear = Math.floor(deadYear / 10) * 10 + 200;
                var table = document.getElementById("yearTable");
                table.innerHTML = "";
                for (var decade = startYear / 10; decade <= endYear / 10; decade++) {
                    var newRow = table.insertRow();
                    for (var i = 0; i < 10; i++) {
                        var year = decade * 10 + i;
                        var age = year - birthYear;
                        var toDea = deadYear - year;
                        var cell = newRow.insertCell();
                        var yearDesc = "<div class='year-class'>" + year + "</div>";
                        var ageIcon = "";
                        if (age >= 0 && toDea >= 0) {

                            if (toDea == 0 || age == 0) {
                                ageIcon = ageIconArr[0];
                            } else if (age / deathAge <= 2 / 60) {
                                ageIcon = ageIconArr[1];
                            } else if (age / deathAge <= 12 / 60) {
                                ageIcon = ageIconArr[2];
                            } else if (age / deathAge <= 20 / 60) {
                                ageIcon = ageIconArr[3];
                            } else if (age / deathAge <= 40 / 60) {
                                ageIcon = ageIconArr[4];
                            } else if (age / deathAge <= 55 / 60) {
                                ageIcon = ageIconArr[5];
                            } else {
                                ageIcon = ageIconArr[6];
                            }
                        }
                        var ageDesc = "<div><span class='age-icon'>" + ageIcon + "</span><span class='age-span'>age:" + age + "</span></div>";
                        var toDeaDesc = "<div>to dea:" + toDea + "</div>";
                        if (currentYear == year) {
                            var progress = Math.round(age / deathAge * 100);
                            if (progress < 0) {
                                progress = 0;
                            }
                            if (progress > 100) {
                                progress = 100;
                            }
                            var yearDesc = "<div><span class='year-class curr-year'>" + year + "</span><span class='progress'>" + progress + "% used</span></div>";
                        }
                        if (age < 0) {
                            ageDesc = "<div>before born:" + (-age) + "</div>";
                            toDeaDesc = "<div>to dea: - </div>"
                        }
                        if (toDea < 0) {
                            ageDesc = "<div>age: - </div>";
                            toDeaDesc = "<div>🪦dead:" + (-toDea) + "</div>";
                        }
                        if (age == 0) {
                            yearDesc = "<div> <span class='year-class'>" + year + "</span><span class='zediac-span'>" + zodiac[year % 12] + "</span></div>";
                        }
                        if (toDea == 0) {
                            yearDesc = "<div> <span class='year-class'>" + year + "</span><span class='zediac-span'>" + zodiac[year % 12] + "</span></div>";
                        }
                        cell.innerHTML = yearDesc + ageDesc + toDeaDesc;
                        if (age < 0) {
                            cell.className += (cell.className ? " " : "") + "alive-before";
                        } else if (toDea >= 0) {
                            cell.className += (cell.className ? " " : "") + "alive";
                        } else {
                            cell.className += (cell.className ? " " : "") + "alive-after";
                        }
                        if (currentYear == year) {
                            cell.className += (cell.className ? " " : "") + "curr-year";
                        }

                    }
                }
            };

            loadLocal();
            refresh();

            $("input").change(function () {
                refresh();
            });
        });
    </script>
</header>

<body>
    <table id="tableInput">
        <tr>
            <td><span>birth:</span></td>
            <td><input id="birthInput" type="date" value="1990-01-01" min="1900-01-01" max="2200-12-31" /></td>
        </tr>
        <tr>
            <td><span>age at death:</span></td>
            <td><input id="deathAge" type="number" value="60" min="1" max="200" /></td>
        </tr>
        <tr>
            <td><span>gender:</span></td>
            <td><span><input type="radio" id="male" name="gender" value="male" checked />Male</span><span><input
                        type="radio" id="female" name="gender" value="female" />Female</span></td>
        </tr>
    </table>
    <table id="yearTable">

    </table>
    <div><span>Life is short, don't worry too much. Take your time and enjoy. Say goodbye to the world on time.</span>
    </div>
</body>
